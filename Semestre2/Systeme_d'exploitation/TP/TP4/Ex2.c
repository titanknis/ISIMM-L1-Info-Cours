#include <pthread.h>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

#define MAX 10

void* fonction(void* arg)
{
    int x = (int)(intptr_t)arg;
    printf("%d\n", x);
    return NULL;
}
void erreur(char* msg)
{
    perror(msg);
    exit(1);
}

int main(int argc, char* argv[])
{
    pthread_t tid[MAX];
    int       i;
    for (i = 0; i < MAX; i++)
    {
        if (pthread_create(&tid[i], NULL, &fonction, (void*)(intptr_t)i))
            erreur("pthread_create");
        /*
         * Why (void*)(intptr_t)i instead of &i?
         * Passing &i would cause a data race because threads might read `i` after it increments.
         * Instead, we cast `i` to a pointer (since pointers are just integers under the hood).
         * This ensures each thread gets its own unique value safely.
         * try to run both and see the difference
         */
    }
    for (i = 0; i < MAX; i++)
        if (pthread_join(tid[i], NULL))
            erreur("pthread_join");
}
