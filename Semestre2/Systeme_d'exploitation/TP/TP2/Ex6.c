#include <stdio.h>
#include <stdlib.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <unistd.h>

// disclaimer
// this is my version of the solution and it simply works and correct
// but it may not be the same as the teacher solution
int main(int argc, char** argv) {
    pid_t pid;
    int   i, status;

    for (i = 0; i < 7; i++) {
        pid = fork();
        if (pid < 0) {
            perror("fork");
            return 1;
        } else if (pid == 0) {
            // make the created child execute the command and return EXIT_FAILURE( equivalent to
            // exit(1) ) in case of failure
            execvp(argv[1], &argv[1]);
            perror("exec");
            exit(EXIT_FAILURE);

        } else {
            // tell chatgpt to explain this (it is not complicated just new)
            wait(&status);
            if (WIFEXITED(status)) {
                if (WEXITSTATUS(status) == 0) {
                    // if we succeed then exit
                    return 0;
                } else {
                    // if we do not succed try again up to 7 times
                    printf("failed %d time\n", i + 1);
                }
            }
        }
    }
    // if we reach here it means we failed to execute the command 7 times
    printf("failed to excecute command: aborting ...\n");
    return 1;
}
