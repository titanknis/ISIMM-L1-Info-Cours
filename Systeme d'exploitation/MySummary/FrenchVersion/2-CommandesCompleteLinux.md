# Commandes Linux Avancées

**Note :** ne soyez pas effrayé par le mot `Avancé` car nous avons déjà étudié ces commandes et opérateurs y compris la gestion des processus dans le TP5.

## 1. Opérateurs et Contrôle sous Linux

### Opérateurs de Base

- `&` - Exécuter en arrière-plan

  ```bash
  # Exécuter une commande en arrière-plan
  gedit monfichier.txt &
  # Vous pouvez continuer à utiliser le terminal pendant que gedit s'exécute
  ```

- `;` - Exécuter les commandes en séquence

  ```bash
  # Les commandes s'exécutent l'une après l'autre, même si la première échoue
  echo "Premier" ; echo "Second"
  # Sortie :
  # Premier
  # Second
  ```

- `&&` - Opérateur ET (exécute la seconde commande uniquement si la première réussit)

  ```bash
  # Créer un répertoire ET y entrer
  mkdir nouveau_dossier && cd nouveau_dossier
  # La seconde commande s'exécute uniquement si la première a fonctionné
  ```

- `||` - Opérateur OU (exécute la seconde commande uniquement si la première échoue)
  ```bash
  # Essayer de créer un répertoire, afficher une erreur s'il échoue
  mkdir dossier_existant || echo "Le dossier existe déjà !"
  ```

### Opérateurs de Redirection

- `>` - Rediriger la sortie (écrase le fichier)

  ```bash
  # Sauvegarder la sortie de ls dans un fichier (crée nouveau ou écrase existant)
  ls > fichiers.txt
  ```

- `>>` - Rediriger la sortie (ajoute au fichier)

  ```bash
  # Ajouter la sortie de ls à la fin du fichier
  ls >> fichiers.txt
  ```

- `2>` - Rediriger les erreurs

  ```bash
  # Masquer les messages d'erreur en les envoyant nulle part
  find / -name "*.txt" 2> /dev/null
  ```

- `|` - Pipe (envoyer la sortie de la première commande à la seconde)

  ```bash
  # Compter combien de fichiers sont dans le répertoire
  ls | wc -l

  # Trouver les fichiers contenant "erreur"
  cat fichier.log | grep "erreur"
  ```

## 2. Combinaisons Utiles

- Compter les fichiers dans un répertoire :
  ```bash
  ls | wc -l
  ```
- Rechercher du texte et compter les correspondances :
  ```bash
  grep "erreur" fichier.log | wc -l
  ```
- Trouver tous les fichiers texte et les copier dans backup :
  ```bash
  cp *.txt backup/
  ```

## 3. Gestion des Processus

### Commandes de Contrôle des Processus

- `Ctrl+C` (C-c) - Arrêter le processus en cours

  ```bash
  # Quand une commande prend trop de temps ou est bloquée
  commande_longue
  # Appuyez sur Ctrl+C pour l'arrêter
  ```

- `Ctrl+Z` (C-z) - Mettre en pause le processus en cours et le placer en arrière-plan

  ```bash
  # Démarrer une commande
  sleep 300
  # Appuyez sur Ctrl+Z pour la mettre en pause
  # [1]+ Stopped sleep 300
  ```

- `Ctrl+D` (C-d) - Envoyer EOF (End Of File - Fin de fichier)
  ```bash
  # Généralement utilisé pour quitter le terminal ou terminer une saisie
  cat > fichier.txt
  bonjour monde
  [Ctrl+D]  # Termine la saisie
  ```

### Commandes de Gestion des Processus

- `jobs` - Lister les processus en arrière-plan

  ```bash
  $ gedit & nano & # Démarrer gedit et nano en arrière-plan
  $ jobs # Lister les tâches en arrière-plan
  [1] Running gedit &
  [2] Stopped nano

  $ jobs -l # Lister les tâches avec leurs PIDs
  [1] 12345 Running gedit &
  [2] 12346 Stopped nano
  ```

- `bg` - Reprendre un processus arrêté en arrière-plan

  ```bash
  $ sleep 300
  [Ctrl+Z]  # Arrête nano
  $ bg      # Reprend sleep en arrière-plan
  ```

- `fg` - Ramener un processus d'arrière-plan au premier plan

  ```bash
  $ jobs
  [1] Running    gedit &
  $ fg 1    # Ramène gedit au premier plan
  ```

- `ps` - Afficher les processus

  ```bash
  $ ps
  PID TTY          TIME CMD
  1234 pts/0    00:00:00 bash
  5678 pts/0    00:00:00 ps
  ```

- `kill` - Arrêter un processus

  ```bash
  # utilisez `jobs -l` ou `ps` pour trouver l'ID du processus (PID)

  # Tuer par ID de processus (PID)
  kill 1234

  # Forcer l'arrêt (quand le processus ne veut pas s'arrêter)
  kill -9 1234
  ```

- `top` ou `htop` ou `gtop` - Afficher les informations des processus en temps réel

  ```bash
  # Affiche les processus en cours, l'utilisation CPU, mémoire
  # Appuyez sur 'q' pour quitter
  $ top
  Tasks: 100 total,   1 running,  99 sleeping...
  ```

### Scénarios Courants de Contrôle des Processus

1. Quand une commande est bloquée :

   ```bash
   $ commande_longue
   [Ctrl+C]  # Arrête la commande
   ```

2. Exécuter plusieurs commandes :

   ```bash
   # Commandes dépendantes du succès
   mkdir test && cd test && touch fichier.txt

   # Commandes indépendantes
   echo "Premier" ; echo "Second" ; echo "Troisième"
   ```

3. Workflow des processus en arrière-plan :
   ```bash
   $ gedit fichier.txt &   # Démarrer en arrière-plan
   $ jobs                  # Vérifier les tâches en cours
   $ fg                    # Ramener au premier plan
   [Ctrl+Z]               # Mettre en pause
   $ bg                    # Reprendre en arrière-plan
   ```

### Conseils pour le Contrôle des Processus :

1. Utilisez `ps` pour vérifier un PID de processus ou de tâche
2. Utilisez `kill` pour tuer le processus (`kill %jobID` ou `kill PID`)
